<section class="projects-section">
  <div class="projects-container">
    <!-- Header -->
    <div class="projects-header">
      <div class="header-content">
        <h1 class="section-title">Meus Projetos</h1>
        <p class="section-subtitle">
          Explore minha coleção de projetos open-source e experimentos técnicos
        </p>
      </div>

      <!-- Stats Cards -->
      @if (!isLoading && !hasError) {
        <div class="stats-cards">
          <div class="stat-card">
            <mat-icon class="stat-icon">folder_open</mat-icon>
            <div class="stat-content">
              <span class="stat-value">{{ totalProjects }}</span>
              <span class="stat-label">Projetos</span>
            </div>
          </div>

          <div class="stat-card">
            <mat-icon class="stat-icon">star</mat-icon>
            <div class="stat-content">
              <span class="stat-value">{{ totalStars }}</span>
              <span class="stat-label">Stars</span>
            </div>
          </div>

          <div class="stat-card">
            <mat-icon class="stat-icon">code</mat-icon>
            <div class="stat-content">
              <span class="stat-value">{{ languages.length }}</span>
              <span class="stat-label">Tecnologias</span>
            </div>
          </div>
        </div>
      }
    </div>

    <!-- Filters -->
    @if (!isLoading && !hasError) {
      <div class="filters-section">
        <div class="filters-container">
          <!-- Search -->
          <mat-form-field appearance="outline" class="search-field">
            <mat-label>Buscar projetos</mat-label>
            <input
              matInput
              [(ngModel)]="searchTerm"
              (ngModelChange)="onSearchChange($event)"
              placeholder="Nome, descrição, tecnologia..."
              autocomplete="off"
            />
            <mat-icon matPrefix>search</mat-icon>
            @if (searchTerm) {
              <button
                mat-icon-button
                matSuffix
                (click)="searchTerm = ''; onSearchChange('')"
                aria-label="Limpar busca"
              >
                <mat-icon>close</mat-icon>
              </button>
            }
          </mat-form-field>

          <!-- Language Filter -->
          <mat-form-field appearance="outline" class="language-field">
            <mat-label>Filtrar por tecnologia</mat-label>
            <mat-select [(ngModel)]="selectedLanguage" (ngModelChange)="onLanguageChange($event)">
              <mat-option value="all">Todas as tecnologias</mat-option>
              @for (lang of languages; track lang) {
                <mat-option [value]="lang">
                  {{ lang }}
                </mat-option>
              }
            </mat-select>
            <mat-icon matPrefix>filter_list</mat-icon>
          </mat-form-field>

          <!-- Clear Filters Button -->
          @if (hasFiltersApplied) {
            <button mat-stroked-button class="clear-filters-btn" (click)="clearFilters()">
              <mat-icon>clear_all</mat-icon>
              Limpar Filtros
            </button>
          }
        </div>

        <!-- Active Filters Chips -->
        @if (hasFiltersApplied) {
          <div class="active-filters">
            <span class="filters-label">Filtros ativos:</span>
            <mat-chip-set aria-label="Filtros ativos">
              @if (searchTerm) {
                <mat-chip (removed)="searchTerm = ''; onSearchChange('')">
                  Busca: "{{ searchTerm }}"
                  <button matChipRemove>
                    <mat-icon>cancel</mat-icon>
                  </button>
                </mat-chip>
              }
              @if (selectedLanguage !== 'all') {
                <mat-chip (removed)="onLanguageChange('all')">
                  Tecnologia: {{ selectedLanguage }}
                  <button matChipRemove>
                    <mat-icon>cancel</mat-icon>
                  </button>
                </mat-chip>
              }
            </mat-chip-set>
          </div>
        }

        <!-- Results Count -->
        <div class="results-info">
          <p class="results-text">
            Exibindo <strong>{{ displayedProjects.length }}</strong> de
            <strong>{{ filteredProjects.length }}</strong> projeto(s)
          </p>
        </div>
      </div>
    }

    <!-- Loading State -->
    @if (isLoading) {
      <div class="loading-state">
        <mat-spinner diameter="60"></mat-spinner>
        <p class="loading-text">Carregando projetos...</p>
      </div>
    }

    <!-- Error State -->
    @if (hasError && !isLoading) {
      <div class="error-state">
        <mat-icon class="error-icon">error_outline</mat-icon>
        <h3 class="error-title">Ops! Algo deu errado</h3>
        <p class="error-message">{{ errorMessage }}</p>
        <button mat-flat-button class="retry-btn" (click)="retryLoad()">
          <mat-icon>refresh</mat-icon>
          Tentar Novamente
        </button>
      </div>
    }

    <!-- Empty State -->
    @if (!isLoading && !hasError && filteredProjects.length === 0) {
      <div class="empty-state">
        <mat-icon class="empty-icon">search_off</mat-icon>
        <h3 class="empty-title">Nenhum projeto encontrado</h3>
        <p class="empty-message">
          Tente ajustar os filtros ou limpar a busca para ver mais resultados.
        </p>
        <button mat-stroked-button class="clear-btn" (click)="clearFilters()">
          <mat-icon>clear_all</mat-icon>
          Limpar Filtros
        </button>
      </div>
    }

    <!-- Projects Grid -->
    @if (!isLoading && !hasError && displayedProjects.length > 0) {
      <div class="projects-grid">
        @for (project of displayedProjects; track project; let i = $index) {
          <app-github-card
            [repoName]="project.repoName"
            [username]="project.username"
            [description]="project.description"
            [stars]="project.stars"
            [language]="project.language"
            [date]="project.date"
            [githubUrl]="project.githubUrl"
            [imageUrl]="project.imageUrl"
            [style.animation-delay]="getAnimationDelay(i)"
            class="project-card-item"
          >
          </app-github-card>
        }
      </div>
    }

    <!-- Pagination -->
    @if (!isLoading && !hasError && totalPages > 1) {
      <div class="pagination-section">
        <div class="pagination-container">
          <!-- Previous Button -->
          <button
            mat-icon-button
            class="pagination-btn"
            [disabled]="currentPage === 1"
            (click)="previousPage()"
            aria-label="Página anterior"
          >
            <mat-icon>chevron_left</mat-icon>
          </button>

          <!-- Page Numbers -->
          <div class="page-numbers">
            @for (page of pageNumbers; track page) {
              <button
                mat-button
                class="page-btn"
                [class.active]="page === currentPage"
                [class.ellipsis]="page === -1"
                [disabled]="page === -1"
                (click)="goToPage(page)"
              >
                {{ page === -1 ? '...' : page }}
              </button>
            }
          </div>

          <!-- Next Button -->
          <button
            mat-icon-button
            class="pagination-btn"
            [disabled]="currentPage === totalPages"
            (click)="nextPage()"
            aria-label="Próxima página"
          >
            <mat-icon>chevron_right</mat-icon>
          </button>
        </div>

        <!-- Page Info -->
        <p class="page-info">Página {{ currentPage }} de {{ totalPages }}</p>
      </div>
    }
  </div>
</section>
